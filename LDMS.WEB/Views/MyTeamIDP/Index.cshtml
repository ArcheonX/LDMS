@{
    ViewData["Title"] = "My Team IDP";
    ViewData["MainTitle"] = "My-Team";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
    <div class="panel panel-primary" style="margin-top:-15px;width:100%;">
        <div class="panel panel-default" style="width:100%;border-width:thin;border-style:solid;">
            @*//Search Panel*@
            <div class="panel-body" style="width:100%;">
                <form method="post">
                    @Html.AntiForgeryToken()  @*CSRF Protected*@

                    <div class="form-horizontal" style="margin-top:25px">
                        <div class="row form-group">
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Plant ID</label>
                                </span>
                            </div>
                            <div class="col-sm-4 col-md-4">
                                <select id="selectPlant"
                                        name="selectPlant"
                                        title="Please Enter Plant"
                                        class="form-control required"
                                        style="width: 100%">
                                </select>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Center</label>
                                </span>
                            </div>
                            <div class="col-sm-3 col-md-3">
                                <select id="selectCenter"
                                        name="selectCenter"
                                        title="Please Enter Center"
                                        class="form-control required"
                                        style="width: 100%"
                                        disabled="disabled">
                                </select>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Divison</label>
                                </span>
                            </div>
                            <div class="col-sm-4 col-md-4">
                                <select id="selectDivision"
                                        name="selectDivision"
                                        title="Please Enter Division"
                                        class="form-control required"
                                        style="width: 100%"
                                        disabled="disabled">
                                </select>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Department</label>
                                </span>
                            </div>
                            <div class="col-3">
                                <select id="selectDepartment"
                                        name="selectDepartment"
                                        title="Please Enter Department"
                                        class="form-control required"
                                        style="width: 100%"
                                        disabled="disabled">
                                </select>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Status</label>
                                </span>
                            </div>
                            <div class="col-4">
                                <select id="selectCourseStatus" name="selectCourseStatus" class="form-control" style="width: 100%">
                                    <option value="0">-- Select All --</option>
                                    <option value="10">Not Start</option>
                                    <option value="30">On Progress</option>
                                    <option value="70">Complete</option>
                                    <option value="99">Incomplete</option>
                                </select>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <span class="pull-right">
                                    <label class="LabelCaption">Employee</label>
                                </span>
                            </div>
                            <div class="col-3">
                                <input type="text" id="txtEmployeeID" class="form-control input-sm" />
                            </div>
                        </div>

                        <div class="row form-group">
                            <div class="col-sm-2 col-md-2 offset-9">
                                <a id="btnSeacrh" class="btn btn-info waves-effect waves-light" style="width:100%; color:white;" onclick="Search()"> Search </a>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="table-responsive m-t-40">
            @* Result Panel *@
            <table class="display dataTable" width="100%" id="dtCourseList">
                <thead>
                    <tr>
                        <th style="text-align:center;width:100px">Name:</th>
                        <th style="text-align:center;width:150px">Position:</th>
                        <th style="text-align:center;width:150px">Service(Year):</th>
                        <th style="text-align:center;width:150px">IDP Time Line:</th>
                        <th style="text-align:center;width:150px">IDP Start:</th>
                        <th style="text-align: center;width:50px">IDP End:</th>
                        <th style="text-align:center;width:50px">IDP Objective</th>
                        <th style="text-align:center;width:50px">Total Review</th>
                        <th style="text-align:center;width:50px">IDP Status</th>
                        <th style="text-align:center;width:50px">Update Date</th>
                        <th style="text-align:center;width:50px">Update Time</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        @section Scripts{
            <style type="text/css">
                .form-group {
                    margin-bottom: 1.5rem;
                }
            </style>

            <script type="text/javascript">
        $(document).ready(function () {

            $('select').select2({
                allowClear: true,
                closeOnSelect: true,
                theme: "bootstrap"
            });

            loadPlant();
            //loadPlatform();
            //LoadCourseLearnMethod();
            //Search();


            $('select[name="selectPlant"]').on('change', function () {
                var plantid = $(this).val();

                ReloadCenter($, plantid, null);
            });

            $('select[name="selectCenter"]').on('change', function () {
                var centerId = $(this).val();
                ReloadDivision($, centerId, null);
            });

            $('select[name="selectDivision"]').on('change', function () {
                var divisionId = $(this).val();
                ReloadDepartment($, divisionId, null);
            });


            //$('#selectPlant').change(function() {
            //   changePlant(this);
            //});

            //$('#selectCenter').change(function() {
            //    changeCenter(this);
            //});

            //$('#selectDivision').change(function() {

            //    changeDivision(this);
            //});

        });



        function loadPlant() {
            //alert(' loadPlant : ' + @HttpContextAccessor.HttpContext.Request.Cookies["PLANTID"]);
            $.ajax({
                type: "GET",
                url: "/Master/GetAllPlants",
                success: function (response) {
                    var options = $('#selectPlant');
                    options.append($("<option />").val(null).text("Please select"));
                    $.each(response.Data, function () {
                        options.append($("<option />").val(this.ID_Plant).text(this.PlantName_EN));
                    });

                    $('select[name="selectPlant"]').val(@HttpContextAccessor.HttpContext.Request.Cookies["PLANTID"]).trigger('change');
                    //$('select[name="selectPlant"]').val(1).trigger('change');
                },
                failure: function (response) {
                    MessageController.Error(response.responseText, "Error");
                },
                error: function (response) {
                    MessageController.Error(response.responseText, "Error");
                }
            });
            }
        function ReloadCenter($, plantId, callback) {
            //alert('ReloadCenter ' + plantId);
            var options = $('#selectCenter');
            options.empty();
            if (plantId && plantId != "") {
                $.ajax({
                    type: "GET",
                    url: "/Master/GetAllCentersByPlant",
                    data: {
                           plantId : plantId
                           },
                        success: function (response) {
                        options.append($("<option />").val(null).text("Please select"));
                        $.each(response.Data, function () {
                            //if (this.ID_Plant == plantId) {
                               options.append($("<option />").val(this.ID_Center).text(this.CenterName_EN));
                            //}
                        });
                        $('select[name="selectCenter"]').val(@HttpContextAccessor.HttpContext.Request.Cookies["CENTERID"]).trigger('change');
                        document.getElementById("selectCenter").disabled = false;

                        if (callback) {
                            //callback($("#userDivisionId").val());
                        }
                    },
                    failure: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    },
                    error: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    }
                });



            }
        }

        function ReloadDivision($, centerId, callback) {
            var options = $('#selectDivision');
            options.empty();
            if (centerId && centerId != "") {
                $.ajax({
                    type: "GET",
                    url: "/Master/GetAllDivisionsByCenter",
                    data: {
                        centerId : centerId
                    },
                    success: function (response) {
                        options.append($("<option />").val(null).text("Please select"));
                        $.each(response.Data, function () {
                            //if (this.ID_Center == centerId) {
                                options.append($("<option />").val(this.ID_Division).text('(' + this.DivisionID + ') ' + this.DivisionName_EN));
                            //}
                        });
                        $('select[name="selectDivision"]').val(@HttpContextAccessor.HttpContext.Request.Cookies["DIVISIONID"]).trigger('change');
                        document.getElementById("selectDivision").disabled = false;


                        if (callback) {
                            //callback($("#userDivisionId").val());
                        }
                    },
                    failure: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    },
                    error: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    }
                });
            }
        }

        function ReloadDepartment($, divisionId, callback) {
            var options = $('#selectDepartment');
            options.empty();
            if (divisionId && divisionId != "") {
                $.ajax({
                    type: "GET",
                    url: "/Master/GetAllDepartmentsByDivision",
                    data: {
                        divisionId : divisionId
                    },
                    success: function (response) {
                        options.append($("<option />").val(null).text("Please select"));
                        $.each(response.Data, function () {
                            //if (this.ID_Division == divisionId) {
                                options.append($("<option />").val(this.ID_Department).text('(' + this.DepartmentID + ') ' + this.DepartmentName_EN));
                            //}
                        });

                        $('select[name="selectDepartment"]').val(@HttpContextAccessor.HttpContext.Request.Cookies["DEPARTMENTID"]).trigger('change');
                        document.getElementById("selectDepartment").disabled = false;


                        if (callback) {
                            //callback($("#userDepartmentId").val());
                        }
                    },
                    failure: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    },
                    error: function (response) {
                        MessageController.Error(response.responseText, "Error");
                    }
                });
            }
        }
            </script>
    }
